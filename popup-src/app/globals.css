@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  html, body {
    width: 450px;
    min-height: 600px; /* Use min-height instead of fixed height */
    max-height: 750px; /* Set max height to prevent overflow */
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    overflow-y: auto;
    /* Prevent zoom from closing extension */
    transform-origin: top left;
    position: relative;
    box-sizing: border-box;
  }

  /* Prevent extension from closing on zoom */
  html {
    zoom: 1 !important;
    transform: scale(1) !important;
  }

  /* Ensure no white space at bottom */
  * {
    box-sizing: border-box;
  }

  body {
    background: linear-gradient(135deg, #581c87 0%, #7c3aed 100%);
    background-attachment: fixed;
  }

  /* Handle browser zoom gracefully */
  @media screen and (min-resolution: 1.25dppx) {
    html, body {
      zoom: 0.8;
    }
  }

  @media screen and (min-resolution: 1.5dppx) {
    html, body {
      zoom: 0.67;
    }
  }

  @media screen and (min-resolution: 2dppx) {
    html, body {
      zoom: 0.5;
    }
  }

  /* Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .popup-container {
      @apply bg-black text-white;
    }
    
    .metrics-card {
      @apply bg-white/20 border border-white/40;
    }
    
    .debug-section {
      @apply bg-white/10 border border-white/30;
    }
  }

  /* Focus management */
  :focus {
    outline: 2px solid #60a5fa;
    outline-offset: 2px;
  }

  :focus:not(:focus-visible) {
    outline: none;
  }

  :focus-visible {
    outline: 2px solid #60a5fa;
    outline-offset: 2px;
  }
}

@layer components {
  .popup-container {
    @apply w-full min-h-full bg-gradient-to-br from-purple-900 to-violet-900 text-white p-5 overflow-y-auto;
    /* Ensure sufficient contrast ratio (4.5:1 minimum) */
    background: linear-gradient(135deg, #581c87 0%, #7c3aed 100%);
    box-sizing: border-box;
    /* Ensure gradient covers entire container without white space */
    background-attachment: local;
  }

  .fullscreen-mode {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw !important;
    height: 100vh !important;
    min-height: 100vh !important;
    z-index: 9999;
    padding: 2rem;
    overflow-y: auto;
    box-sizing: border-box;
    /* Ensure gradient covers entire fullscreen without white space */
    background-attachment: fixed;
  }
  
  .metrics-card {
    @apply bg-white/15 backdrop-blur-sm rounded-xl p-5 mb-5 border border-white/10;
    /* Enhanced contrast for better readability */
  }
  
  .metric-item {
    @apply flex justify-between items-center py-3 border-b border-white/20 last:border-b-0;
    /* Increased border opacity for better visibility */
  }
  
  .metric-label {
    @apply text-sm text-white/95 font-medium;
    /* Improved contrast ratio */
  }
  
  .metric-value {
    @apply text-lg font-semibold text-white;
    /* Ensure maximum contrast for values */
  }
  
  .debug-section {
    @apply bg-white/10 rounded-lg p-4 mt-5 border border-white/10;
    /* Added border for better definition */
  }
  
  .btn-primary {
    @apply bg-white/25 hover:bg-white/35 disabled:opacity-60 disabled:cursor-not-allowed text-white border-none px-3 py-2 rounded-md cursor-pointer text-xs transition-colors duration-200;
    /* Increased background opacity for better contrast */
  }
  
  .btn-success {
    @apply bg-green-500/40 hover:bg-green-500/50;
    /* Enhanced green contrast */
  }

  /* Accessibility improvements */
  .sr-only {
    @apply absolute w-px h-px p-0 -m-px overflow-hidden whitespace-nowrap border-0;
    clip: rect(0, 0, 0, 0);
  }

  /* Skip link for keyboard navigation */
  .skip-link {
    @apply absolute -top-10 left-4 bg-white text-black px-4 py-2 rounded-md font-medium z-50 transition-all duration-200;
  }

  .skip-link:focus {
    @apply top-4;
  }

  /* Enhanced focus indicators */
  button:focus-visible,
  [role="button"]:focus-visible {
    @apply ring-2 ring-blue-400 ring-offset-2 ring-offset-transparent;
  }

  /* Tooltip accessibility */
  [role="tooltip"] {
    @apply pointer-events-none;
  }

  /* High contrast text for better readability */
  .text-high-contrast {
    color: #ffffff;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* Loading state accessibility */
  .loading-spinner {
    @apply animate-spin;
  }

  @media (prefers-reduced-motion: reduce) {
    .loading-spinner {
      @apply animate-pulse;
    }
  }
}